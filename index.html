<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GÃ¶rev YÃ¶netim Paneli</title>
    <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; margin: 0; display: flex; flex-direction: column; align-items: center; }
        .resim { width: 95%; max-width: 300px; margin-top: 10px; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); text-align: center; }
        .container { width: 95%; max-width: 600px; margin-top: 10px; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); text-align: center; }
        h1 { color: #2c3e50; margin-bottom: 20px; font-size: 24px; }
        .input-group { display: flex; flex-direction: column; gap: 15px; }
        input { padding: 15px; border: 2px solid #eee; border-radius: 10px; font-size: 16px; transition: border-color 0.3s; }
        input:focus { border-color: #ff6d5a; outline: none; }
        button { padding: 15px; background-color: #ff6d5a; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; font-weight: bold; transition: background 0.3s; }
        button:hover { background-color: #e85a49; }
        button:disabled { background-color: #ccc; }
        .info { margin-top: 20px; font-size: 0.85em; color: #340911; }
        #statusMsg { margin-top: 15px; font-weight: bold; color: #27ae60; display: none; }
    </style>
</head>
<body>
<div class="resim">
    <img src="IMG_1510.jpg" alt="Foto" width="300" height="200">
</div>
    <div class="container">
        <h1>ðŸ“‹ Yeni GÃ¶rev TanÄ±mlama</h1>
        <div class="input-group">
            <input type="text" id="taskInput" placeholder="Gorev...">
            <input type="date" id="tarihInput" placeholder="Tarih...">
            <input type="text" id="kisiInput" placeholder="Kisi...">
            <input type="text" id="yerInput" placeholder="Yer...">
            <input type="email" id="epostaInput" placeholder="e-posta...">
            <button onclick="gorevKaydet()" id="submitBtn">GÃ¶revi Sisteme Kaydet</button>
        </div>
        <p id="statusMsg">âœ… GÃ¶rev baÅŸarÄ±yla kaydedildi!</p>
        <p class="info">Not: Form verileri doÄŸrudan n8n Ã¼zerinden Sheets ve Pinecone'a iletilir.</p>
    </div>

    <script type="module">
        import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';
        
        createChat({
            webhookUrl: 'https://332dc8d379be.ngrok-free.app/webhook/05903637-f70b-45b0-86b3-e24c0f641cb3/chat',
            webhookConfig: {
                method: 'POST',
                headers: {
                    'ngrok-skip-browser-warning': 'true'
                }
            },
            showWelcomeScreen: false,
            initialMessages: [
                'Merhaba! ðŸ‘‹',
                'Ben ev iÃ§i gÃ¶rev asistanÄ±yÄ±m. SorularÄ±nÄ±zÄ± sorabilirsiniz.'
            ],
            i18n: {
                en: {
                    title: 'Asistan ðŸ‘‹',
                    subtitle: "Size nasÄ±l yardÄ±mcÄ± olabilirim?",
                    inputPlaceholder: 'Sorunuzu yazÄ±n...',
                    getStarted: 'Yeni Sohbet'
                },
            }
        });
    </script>

    <script>
        // Form verisini n8n Webhook dÃ¼ÄŸÃ¼mÃ¼ne gÃ¶nderen fonksiyon
        async function gorevKaydet() {
            const taskValue = document.getElementById('taskInput').value;
            const tarihValue = document.getElementById('tarihInput').value;
            const kisiValue = document.getElementById('kisiInput').value;
            const yerValue = document.getElementById('yerInput').value;
            const epostaValue = document.getElementById('epostaInput').value;
            const btn = document.getElementById('submitBtn');
            const msg = document.getElementById('statusMsg');

            if (!taskValue) {
                alert("LÃ¼tfen bir gÃ¶rev aÃ§Ä±klamasÄ± girin.");
                return;
            }

            btn.innerText = "Kaydediliyor...";
            btn.disabled = true;

            try {
                // BURAYA n8n'de oluÅŸturduÄŸun yeni WEBHOOK URL'sini yapÄ±ÅŸtÄ±r
                const response = await fetch('https://332dc8d379be.ngrok-free.app/webhook/yeni-gorev', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'ngrok-skip-browser-warning': 'true'
                    },
                    body: JSON.stringify({ 
                        task: taskValue,
                        tarih: tarihValue,
                        kisi: kisiValue,
                        yer: yerValue,
                        eposta: epostaValue 
                    })
                });

                if (response.ok) {
                    msg.style.display = 'block';
                    document.getElementById('taskInput').value = '';
                    setTimeout(() => { msg.style.display = 'none'; }, 3000);
                } else {
                    alert("Bir sorun oluÅŸtu. n8n'den hata dÃ¶ndÃ¼.");
                }
            } catch (error) {
                alert("BaÄŸlantÄ± hatasÄ±! Ngrok veya n8n Ã§alÄ±ÅŸÄ±yor mu?");
                console.error(error);
            } finally {
                btn.innerText = "GÃ¶revi Sisteme Kaydet";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>